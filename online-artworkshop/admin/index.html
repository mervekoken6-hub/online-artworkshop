<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel ‚Ä¢ Online Art Workshop</title>
  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#05060a;
      --card: rgba(12,18,32,.92);
      --soft: rgba(255,255,255,.10);
      --muted: rgba(255,255,255,.78);
      --a1:#60a5fa;
      --a2:#a78bfa;
      --ok:#34d399;
      --bad:#fb7185;
      --warn:#facc15;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(circle at top, var(--bg1), var(--bg2));
      color:#fff;
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:28px 12px;
    }
    .wrap{width:100%; max-width:1080px;}
    .card{
      background:var(--card);
      border:1px solid rgba(255,255,255,.06);
      box-shadow:0 25px 60px rgba(0,0,0,.55);
      border-radius:18px;
      padding:18px;
    }
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      margin-bottom:12px;
    }
    h1{margin:0; font-size:18px; letter-spacing:.2px}
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 12px; border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:var(--muted);
      font-size:13px;
    }
    .btn{
      border:none; cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      background:linear-gradient(135deg,var(--a1),var(--a2));
      color:#fff;
      font-weight:650;
    }
    .btn.ghost{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:#fff;
    }
    .grid{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width:980px){ .grid{grid-template-columns:1fr;} }

    /* login */
    .loginBox label{display:block; font-size:13px; margin:10px 0 6px; color:rgba(255,255,255,.9)}
    .loginBox input{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:#fff;
      outline:none;
    }
    .hint{font-size:12px; color:rgba(255,255,255,.7); margin-top:10px; line-height:1.5}
    .msg{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:var(--muted);
      font-size:13px;
    }
    .msg.ok{border-color:rgba(52,211,153,.35); color:#d1fae5}
    .msg.bad{border-color:rgba(251,113,133,.45); color:#ffe4e6}

    /* tabs */
    .tabs{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px;}
    .tab{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      cursor:pointer;
      color:#fff;
      font-size:13px;
    }
    .tab.active{
      background:linear-gradient(135deg, rgba(96,165,250,.25), rgba(167,139,250,.25));
      border-color:rgba(167,139,250,.45);
    }

    /* table */
    .tools{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-bottom:10px;
    }
    .search{
      width:260px; max-width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:#fff;
      outline:none;
    }
    .muted{color:var(--muted); font-size:13px}
    .tableWrap{overflow:auto; border-radius:14px; border:1px solid rgba(255,255,255,.08)}
    table{width:100%; border-collapse:collapse; min-width:900px; background:rgba(255,255,255,.02)}
    th,td{
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      font-size:13px;
      vertical-align:top;
      white-space:nowrap;
    }
    th{
      position:sticky; top:0;
      background:rgba(10,14,24,.92);
      text-align:left;
      z-index:1;
    }
    tr:hover td{background:rgba(255,255,255,.03)}
    .statusSel{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:#fff;
      outline:none;
      cursor:pointer;
    }
    .mini{
      font-size:12px; color:rgba(255,255,255,.7);
    }
    .badge{
      display:inline-block;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:#fff;
      font-size:12px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <h1>üßô‚Äç‚ôÄÔ∏è Admin Panel ‚Ä¢ Online Art Workshop</h1>
        <div class="pill">
          <span id="apiState">API: bilinmiyor</span>
          <span class="badge" id="who">Giri≈ü yok</span>
        </div>
      </div>

      <div class="grid">
        <!-- LEFT: Login + Ayar -->
        <div class="card loginBox" style="padding:16px;">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
            <strong>Giri≈ü</strong>
            <button class="btn ghost" id="logoutBtn" type="button" style="display:none;">√áƒ±kƒ±≈ü</button>
          </div>

          <div id="loginArea">
            <label>≈ûifre</label>
            <input id="pw" type="password" placeholder="≈ûifreyi yaz" />
            <button class="btn" id="loginBtn" type="button" style="margin-top:12px; width:100%;">Giri≈ü Yap</button>
            <div class="hint">≈ûifre: <b>cadimagic2025</b> (sen ve arkada≈üƒ±n aynƒ± ≈üifreyle girer)</div>
            <div class="msg" id="loginMsg" style="display:none;"></div>
          </div>

          <hr style="border:0; border-top:1px solid rgba(255,255,255,.08); margin:16px 0;">

          <strong>API URL</strong>
          <div class="mini" style="margin:6px 0 10px;">
            Apps Script Web App URL‚Äôn (‚Ä¶/exec). Formlarda kullandƒ±ƒüƒ±n URL ile aynƒ± olmalƒ±.
          </div>
          <input id="apiUrl" type="text" />

          <button class="btn ghost" id="saveApiBtn" type="button" style="margin-top:10px; width:100%;">Kaydet</button>
          <div class="msg" id="apiMsg" style="display:none;"></div>
        </div>

        <!-- RIGHT: Panel -->
        <div class="card" style="padding:16px;">
          <div class="tabs" id="tabs" style="display:none;">
            <button class="tab active" data-type="cadi" type="button">Cadƒ± At√∂lyesi Kayƒ±tlarƒ±</button>
            <button class="tab" data-type="canli" type="button">Canlƒ± Ders Kayƒ±tlarƒ±</button>
          </div>

          <div class="tools" id="tools" style="display:none;">
            <input class="search" id="search" placeholder="Ara (ad, telefon, eposta, tarih‚Ä¶)" />
            <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
              <span class="muted" id="count">0 kayƒ±t</span>
              <button class="btn" id="refreshBtn" type="button">Yenile</button>
            </div>
          </div>

          <div class="msg" id="panelMsg">Giri≈ü yaptƒ±ktan sonra kayƒ±tlar burada g√∂r√ºnecek.</div>

          <div class="tableWrap" id="tableWrap" style="display:none; margin-top:12px;">
            <table>
              <thead>
                <tr id="thead"></tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <div class="mini" id="note" style="display:none; margin-top:10px;">
            Durum deƒüi≈ütirince otomatik kaydeder. (Beklemede / √ñdendi / ƒ∞ptal)
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ‚úÖ ≈ûifre
  const ADMIN_PASSWORD = "cadimagic2025";

  // ‚úÖ Varsayƒ±lan API URL (istersen burayƒ± da formdaki URL ile aynƒ± bƒ±rak)
  const DEFAULT_API_URL = "https://script.google.com/macros/s/AKfycbwD4chBKNlbOIoymVZtPEYCx-YRhwA2hssBPZck-7695kRMN22xAtgSrW94Ck9HsdEJ0Q/exec";

  // LocalStorage key‚Äôler
  const LS_AUTH = "admin_auth_ok";
  const LS_API  = "admin_api_url";

  const apiUrlInput = document.getElementById("apiUrl");
  const apiMsg = document.getElementById("apiMsg");
  const apiState = document.getElementById("apiState");
  const who = document.getElementById("who");

  const loginArea = document.getElementById("loginArea");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const pw = document.getElementById("pw");
  const loginMsg = document.getElementById("loginMsg");

  const tabs = document.getElementById("tabs");
  const tools = document.getElementById("tools");
  const panelMsg = document.getElementById("panelMsg");
  const tableWrap = document.getElementById("tableWrap");
  const thead = document.getElementById("thead");
  const tbody = document.getElementById("tbody");
  const search = document.getElementById("search");
  const refreshBtn = document.getElementById("refreshBtn");
  const count = document.getElementById("count");
  const note = document.getElementById("note");

  // State
  let currentType = "cadi";
  let allRows = [];
  let headers = [];

  function getApiUrl(){
    return (localStorage.getItem(LS_API) || DEFAULT_API_URL).trim();
  }
  function setApiUrl(url){
    localStorage.setItem(LS_API, url.trim());
  }

  // Init API URL input
  apiUrlInput.value = getApiUrl();

  function showMsg(el, text, kind){
    el.style.display = "block";
    el.className = "msg" + (kind ? " " + kind : "");
    el.textContent = text;
  }

  async function ping(){
    try{
      const res = await fetch(getApiUrl(), { method:"GET" });
      const j = await res.json();
      if(j && j.ok){
        apiState.textContent = "API: √ßalƒ±≈üƒ±yor ‚úÖ";
        showMsg(apiMsg, "API baƒülantƒ±sƒ± ba≈üarƒ±lƒ± ‚úÖ", "ok");
      } else {
        apiState.textContent = "API: hata ‚ö†Ô∏è";
        showMsg(apiMsg, "API yanƒ±t verdi ama ok:false d√∂nd√º.", "bad");
      }
    }catch(e){
      apiState.textContent = "API: ula≈üƒ±lamƒ±yor ‚ùå";
      showMsg(apiMsg, "API‚Äôye eri≈üilemedi. URL doƒüru mu ve Apps Script 'Herkes' mi?", "bad");
    }
  }

  document.getElementById("saveApiBtn").addEventListener("click", ()=>{
    setApiUrl(apiUrlInput.value);
    ping();
  });

  // Auth
  function isAuthed(){
    return localStorage.getItem(LS_AUTH) === "1";
  }
  function setAuthed(v){
    localStorage.setItem(LS_AUTH, v ? "1" : "0");
  }

  function setUIAuthed(authed){
    if(authed){
      loginArea.style.display = "none";
      logoutBtn.style.display = "inline-block";
      tabs.style.display = "flex";
      tools.style.display = "flex";
      tableWrap.style.display = "block";
      note.style.display = "block";
      who.textContent = "Giri≈ü yapƒ±ldƒ±";
      panelMsg.style.display = "none";
      loadList();
    }else{
      loginArea.style.display = "block";
      logoutBtn.style.display = "none";
      tabs.style.display = "none";
      tools.style.display = "none";
      tableWrap.style.display = "none";
      note.style.display = "none";
      who.textContent = "Giri≈ü yok";
      panelMsg.style.display = "block";
      panelMsg.textContent = "Giri≈ü yaptƒ±ktan sonra kayƒ±tlar burada g√∂r√ºnecek.";
    }
  }

  loginBtn.addEventListener("click", ()=>{
    const val = pw.value.trim();
    if(val === ADMIN_PASSWORD){
      setAuthed(true);
      loginMsg.style.display="none";
      pw.value = "";
      setUIAuthed(true);
    } else {
      showMsg(loginMsg, "≈ûifre yanlƒ±≈ü.", "bad");
    }
  });

  logoutBtn.addEventListener("click", ()=>{
    setAuthed(false);
    setUIAuthed(false);
  });

  // Tabs
  document.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", ()=>{
      document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
      t.classList.add("active");
      currentType = t.dataset.type;
      loadList();
    });
  });

  refreshBtn.addEventListener("click", loadList);

  search.addEventListener("input", ()=>{
    renderTable(filterRows(search.value));
  });

  function filterRows(q){
    q = (q || "").toLowerCase().trim();
    if(!q) return allRows.slice();
    return allRows.filter(r=>{
      return JSON.stringify(r).toLowerCase().includes(q);
    });
  }

  async function loadList(){
    const url = new URL(getApiUrl());
    url.searchParams.set("action", "list");
    url.searchParams.set("type", currentType);

    try{
      count.textContent = "Y√ºkleniyor...";
      const res = await fetch(url.toString(), { method:"GET" });
      const j = await res.json();

      if(!j || j.ok !== true) throw new Error(j?.error || "Liste alƒ±namadƒ±");

      headers = j.headers || [];
      allRows = (j.rows || []).map(x=>x);

      renderHeader(headers);
      renderTable(filterRows(search.value));
      count.textContent = `${allRows.length} kayƒ±t`;

    }catch(e){
      panelMsg.style.display = "block";
      panelMsg.textContent = "Hata: " + (e.message || e);
      tableWrap.style.display = "none";
      note.style.display = "none";
      count.textContent = "0 kayƒ±t";
    }
  }

  function renderHeader(headers){
    // Admin i√ßin "Durum" s√ºtununu dropdown yapacaƒüƒ±z
    thead.innerHTML = "";
    const wanted = headers.length ? headers : ["KayitTarihi","AdSoyad","Eposta","Telefon","Tarih","Seans","Ucret","Not","Dil","Durum"];
    wanted.forEach(h=>{
      const th = document.createElement("th");
      th.textContent = h;
      thead.appendChild(th);
    });
    // Satƒ±r numarasƒ±nƒ± da g√∂stermek istersen:
    const th2 = document.createElement("th");
    th2.textContent = "Satƒ±r";
    thead.appendChild(th2);
  }

  function renderTable(rows){
    tbody.innerHTML = "";
    const wanted = headers.length ? headers : ["KayitTarihi","AdSoyad","Eposta","Telefon","Tarih","Seans","Ucret","Not","Dil","Durum"];

    rows.forEach(r=>{
      const tr = document.createElement("tr");

      wanted.forEach(h=>{
        const td = document.createElement("td");

        if(String(h).toLowerCase() === "durum"){
          const sel = document.createElement("select");
          sel.className = "statusSel";
          ["Beklemede","√ñdendi","ƒ∞ptal"].forEach(s=>{
            const op = document.createElement("option");
            op.value = s; op.textContent = s;
            sel.appendChild(op);
          });

          const current = (r[h] || "Beklemede").toString();
          sel.value = ["Beklemede","√ñdendi","ƒ∞ptal"].includes(current) ? current : "Beklemede";

          sel.addEventListener("change", async ()=>{
            const ok = await updateStatus(r._rowNumber, sel.value);
            if(!ok){
              alert("Durum kaydedilemedi. Tekrar dene.");
              sel.value = current;
              return;
            }
            r[h] = sel.value;
          });

          td.appendChild(sel);
        } else {
          td.textContent = (r[h] ?? "").toString();
        }

        tr.appendChild(td);
      });

      // row number
      const tdRow = document.createElement("td");
      tdRow.textContent = r._rowNumber;
      tr.appendChild(tdRow);

      tbody.appendChild(tr);
    });
  }

  async function updateStatus(rowNumber, newStatus){
    try{
      const res = await fetch(getApiUrl(),{
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          action: "updateStatus",
          type: currentType,
          rowNumber,
          newStatus
        })
      });

      const j = await res.json();
      return !!(j && j.ok === true);
    }catch(e){
      return false;
    }
  }

  // Start
  ping();
  setUIAuthed(isAuthed());
</script>
</body>
</html>
